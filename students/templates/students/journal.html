{% extends "students/base.html" %}

{% load static from staticfiles %}

{% block meta_title %}Облік Відвідування{% endblock meta_title %}

{% block title %}Облік Відвідування{% endblock title %}

{% block content %}
   
<!-- Start Students Listing -->

{% if students %}

<div class="alert alert-info" role="info">
    Зміни в журнал зберігаються автоматично при кожному кліку в клітинці таблиці.
    <span id="ajax-progress-indicator">Йде збереження...</span>
</div>

<p id="journal-nav" class="month text-center">
  <a href="?month={{ prev_month }}"
     title="Попередній Місяць">&larr;</a>
  <strong>{{ month_verbose }} {{ year }}</strong>
  <a href="?month={{ next_month }}"
     title="Наступний Місяць">&rarr;</a>
</p>
      
<!-- Start Group Listing -->
<table class="table table-hover table-striped table-bordered" id="students-journal">

  <thead>
    <tr class="header">
      <th class="num">№</th>
      <th class="name">Студент</th>
      {% for day in month_header %}
      <th class="day-header">{{ day.verbose }}</br>{{ day.day }}</th>
      {% endfor %}
    </tr>
  </thead>
  
  <tbody>

    {% csrf_token %}
    {% for student in students %}
    <tr>
      
      <td>
        {{ page_obj.start_index|add:forloop.counter|add:"-1" }}
      </td>
      
      <td><a class="form-link" title="Редагувати"
           href="{% url "students_edit" student.id %}">
           {{ student.fullname }}</a></td>
      {% for day in student.days %}
      <td class="day-box">
        {% if disabled is None and day.day|add:0 <= current_day|add:0 %}
        <input type="checkbox" data-student-id="{{ student.id }}"
               data-date="{{ day.date }}" data-url="{{ student.update_url }}"
               value="1" {% if day.present %}checked="checked"{% endif %}>
        {% else %}
        -
        {% endif %}
      </td>
      {% endfor %}
      
    </tr>
    {% endfor %}
  
  </tbody>
  
</table>
{{ context }}
{% if is_paginated and page_obj.number < paginator.num_pages %}
    {% with url_page=request.path_info %}
    <p class="buttonLoad">
      <a type="button" class="btn btn-default" href="{{ url_page }}?page={{ page_obj.next_page_number }}{% if cur_month %}&amp;month={{ cur_month }}{% endif %}" id="buttonLoadMore">Завантажити ще</a>
    </p>
    {% endwith %}
  {% endif %}

{% else %}
<p class='none'></br></br>Поки немає жодного студента в базі. Будь-ласка, <a
        href="{% url "students_add" %}">додайте</a> першого</p>
{% endif %}

<!-- End Students Listing -->

{% include 'students/pagination.html' %}

{% endblock content %}
